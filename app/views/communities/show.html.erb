<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>Offcanvas navbar template Â· Bootstrap v5.1</title>
    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Custom styles for this template -->
  </head>
  <% if !@user_participation.present? || (@user_participation.present? && !@user_participation.banned)%>
    <body class="bg-light">
      <%= render "partials/navbar" %>
      <div style="padding: 40pt"></div>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div id="content" class="content content-full-width">
              <!-- begin profile -->
              <div class="profile">
                <div class="profile-header">
                  <!-- BEGIN profile-header-cover -->
                  <div class="profile-header-cover"></div>
                  <!-- END profile-header-cover -->
                  <!-- BEGIN profile-header-content -->
                  <div class="profile-header-content">
                    <!-- BEGIN profile-header-img -->
                    <div class="profile-header-img">
                    </div>
                    <!-- END profile-header-img -->
                    <!-- BEGIN profile-header-info -->
                    <div class="profile-header-info">
                      <h4 class="m-t-10 m-b-5"><%= @community.name %></h4>
                      <p class="m-b-10"><%= @community.description %></p>
                      <% if @user_participation.present? && @user_participation.user_id == current_user.id %>
                        <%= button_to "Modifica Community", edit_community_path(community_id: @community.id), method: :get %>
                        <%= button_to "Elimina Community", community_path(community_id: @community.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete %>
                      <% elsif current_user.participations.where(community_id: @community.id).first == nil %>
                        <%= button_to "Entra in community", create_user_community_participation_path(user_id: current_user.id, community_id: @community.id)%>
                      <% elsif current_user.participations.where(community_id: @community.id, role: :member).first %>
                        <%= button_to "Abbandona community", user_community_participation_path(user_id: current_user.id, community_id: @community.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete %>
                      <% end %>
                    </div>
                    <!-- END profile-header-info -->
                    <div class="pt-2">
                      <span>10 post</span>
                      <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#iscrittiModal">
                        Iscritti
                      </button>
                      <!-- Modal -->
                      <div class="modal fade" id="iscrittiModal" tabindex="-1" aria-labelledby="iscrittiModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="iscrittiModalLabel">Iscritti</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- END profile-header-content -->
                  <!-- BEGIN profile-header-tab -->
                  <ul class="profile-header-tab nav nav-tabs">
                    <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-with-timeline-posts" target="__blank" class="nav-link_">POSTS</a></li>
                    <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-about" target="__blank" class="nav-link_">ABOUT</a></li>
                    <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-photos" target="__blank" class="nav-link_">PHOTOS</a></li>
                    <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-videos" target="__blank" class="nav-link_">VIDEOS</a></li>
                    <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-friend-list" target="__blank" class="nav-link_ active show">FRIENDS</a></li>
                  </ul>
                  <!-- END profile-header-tab -->
                </div>
              </div>
              <!-- end profile -->
              <!-- begin profile-content -->
              <div class="profile-content">
                <% if @user_participation.present? %>
                  <%= button_to "Crea post!", new_community_post_path(@community.id), method: :get %>
                <% end %>
                <!-- begin tab-content -->
                <div class="tab-content p-0">
                  <!-- begin #profile-post tab -->
                  <div class="tab-pane fade active show" id="profile-post">
                    <!-- begin timeline -->
                    <ul class="timeline">
                      <% if @user_participation.present? && @user_participation.user_id == current_user.id %>
                        <% @community.participations.each do |participation| %>
                          <p> <b><%= participation.user.uid %></b> come <%= participation.role %>
                            <% if participation.banned %>
                              BANNATO 
                              <%= button_to "Riammetti", unban_user_community_participation_path(user_id: participation.user_id, community_id: @community.id) %>
                            <% elsif participation.role == "member" %>
                              <%= button_to "Bandisci utente", ban_user_community_participation_path(user_id: participation.user_id, community_id: @community.id)%>
                              <%= button_to "Promuovi a moderatore", promote_user_community_participation_path(user_id: participation.user_id, community_id: @community.id) %>
                            <% elsif participation.role == "moderator" && participation.user_id != current_user.id%>
                              <%= button_to "Bandisci utente", ban_user_community_participation_path(user_id: participation.user_id, community_id: @community.id) %>
                              <%= button_to "Rendi proprietario", move_user_community_participation_path(user_id: participation.user_id, community_id: @community.id) %>
                            <% end %>
                          </p>
                        <% end %>
                      <% elsif @user_participation.present? && @user_participation.role == "moderator"  %>
                        <% @community.participations.each do |participation| %>
                          <p> <b><%= participation.user.uid %></b> come <%= participation.role %>
                            <% if participation.banned %>
                              BANNATO 
                              <%= button_to "Riammetti", unban_user_community_participation_path(user_id: participation.user_id, community_id: @community.id) %>
                            <% elsif participation.role == "member"  %>
                              <%= button_to "Bandisci utente", ban_user_community_participation_path(user_id: participation.user_id, community_id: @community.id)%>
                            <% end %>
                          </p>
                        <% end %>
                      <% end %>
                      <% @posts.each do |community_post| %>
                        <li>
                          <!-- begin timeline-time -->
                          <div class="timeline-time">
                            <span class="date"><%=community_post.created_at.to_fs(:short)%></span>
                            <span class="time"><%=community_post.created_at.to_fs(:short)%></span>
                          </div>
                          <!-- end timeline-time -->
                          <!-- begin timeline-icon -->
                          <div class="timeline-icon">
                            <a href="javascript:;">&nbsp;</a>
                          </div>
                          <!-- end timeline-icon -->
                          <!-- begin timeline-body -->
                          <div class="timeline-body">
                            <div class="timeline-header">
                              <span class="userimage"><img src="<%=community_post.user.avatar_url%>" alt=""></span>
                              <span class="username"><a href="/user/<%= String(community_post.user.uid) %>"><%= community_post.user.uid %></a> <small>su <a href="/communities/<%= String(@community.id) %>"><%= @community.name %></a></small></span>
                              <div class="pull-right">
                                <% if community_post.user == current_user%>
                                  <span><%= button_to "Modifica", edit_post_path(community_post), method: :get %></span>
                                  <span><%= button_to "Elimina", post_path(community_post), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete %></span>
                                <% elsif @user_participation.role == "moderator" %>
                                  <span><%= button_to "Elimina", post_path(community_post), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete %></span>
                                <% end %>
                                <span class="text-muted">
                                  ultima modifica: <%=community_post.updated_at.to_fs(:short)%>
                                </span>
                              </div>
                            </div>
                            <div class="timeline-content">
                              <h3><%= community_post.title %></h3>
                              <p><%= community_post.body %></p>
                            </div>
                            <div class="timeline-likes">
                              <div class="stats-right">
                                <span class="stats-text"><%= community_post.comments.count %> Commenti</span>
                              </div>
                              <div class="stats">
                                <span class="fa-stack fa-fw stats-icon">
                                  <i class="fa fa-circle fa-stack-2x text-primary"></i>
                                  <i class="fa fa-thumbs-up fa-stack-1x fa-inverse"></i>
                                </span>
                                <span class="stats-total"><%= community_post.reactions.where(like: true).count %></span>
                                <span class="fa-stack fa-fw stats-icon">
                                  <i class="fa fa-circle fa-stack-2x text-secondary"></i>
                                  <i class="fa fa-thumbs-down fa-stack-1x fa-inverse"></i>
                                </span>
                                <span class="stats-total"><%= community_post.reactions.where(like: false).count %></span>
                              </div>
                            </div>
                            <div class="timeline-footer">
                              <% if community_post.reactions.where(uid: current_user.uid).first %>
                                <% @reaction = community_post.reactions.where(uid: current_user.uid).first %>
                                <% if @reaction.like == true %>
                                  <%= button_to "Mi piace", post_reaction_path(community_post.id, @reaction.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete%>
                                  <%= button_to "Non mi piace", update_post_reaction_path(community_post.id, @reaction.id), method: :get%>
                                <% else %>
                                  <%= button_to "Mi piace", update_post_reaction_path(community_post.id, @reaction.id), method: :get%>
                                  <%= button_to "Non mi piace", post_reaction_path(community_post.id, @reaction.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, method: :delete%>
                                <% end %>
                              <% else %>
                                <%= render "reactions/like", post: community_post %>
                                <%= render "reactions/dislike", post: community_post %>
                              <% end %>
                              <a href="javascript:;" class="m-r-15 text-inverse-lighter"><i class="fa fa-thumbs-up fa-fw fa-lg m-r-3"></i></a>
                              <a href="javascript:;" class="m-r-15 text-inverse-lighter"><i class="fa fa-thumbs-down fa-fw fa-lg m-r-3"></i></a>
                              <!--<a href="javascript:;" class="m-r-15 text-inverse-lighter"><i class="fa fa-comments fa-fw fa-lg m-r-3"></i> Commenta</a> -->
                            </div>
                            <div class="timeline-comment-box">
                              <% community_post.comments.each do |comment| %>
                                <%= render "comments/comment", post: community_post, comment: comment%>
                              <% end %>
                              <div class="user"><img src="<%=current_user.avatar_url%>"></div>
                              <div class="input">
                                <%= form_with model: [ community_post, community_post.comments.build ] do |form| %>
                                  <%= form.text_field :body %>
                                  <%= form.submit "commenta" %>
                                <% end %>
                                <!--<form action="">
                                       <div class="input-group">
                                          <input type="text" class="form-control rounded-corner" placeholder="Write a comment...">
                                          <span class="input-group-btn p-l-10">
                                          <button class="btn btn-primary f-s-12 rounded-corner" type="button">Comment</button>
                                          </span>
                                       </div>
                                    </form>-->
                              </div>
                            </div>
                          </div>
                          <!-- end timeline-body -->
                        </li>
                      <% end %>
                    </ul>
                  </div>
                  <!-- end #profile-post tab -->
                </div>
                <!-- end tab-content -->
              </div>
              <!-- end profile-content -->
            </div>
          </div>
        </div>
      </div>
    </body>
  <% elsif %>
    <p>SEI BANNATO, <%= link_to "TORNA ALLA HOME", root_path %> </p>
  <% end %>
</html>
