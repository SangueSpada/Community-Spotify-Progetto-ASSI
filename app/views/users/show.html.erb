<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
        <meta name="generator" content="Hugo 0.88.1">
        <title>Offcanvas navbar template · Bootstrap v5.1</title>
        <!-- Bootstrap core CSS -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <!-- Custom styles for this template -->

    </head>
    <body>
        <%= render "partials/navbar" %>
        <div style="padding: 40pt"></div>
        
<div class="container">
   <div class="row">
      <div class="col-md-12">
         <div id="content" class="content content-full-width">
            <!-- begin profile -->
            <div class="profile">
               <div class="profile-header">
                  <!-- BEGIN profile-header-cover -->
                  <div class="profile-header-cover"></div>
                  <!-- END profile-header-cover -->
                  <!-- BEGIN profile-header-content -->
                  <div class="profile-header-content">
                     <!-- BEGIN profile-header-img -->
                     <div class="profile-header-img">
                        <%if @user.images[0]!=nil%>
                           <img src="<%=@user.images[0]['url']%>" alt="" width= "120" height= "114">
                        <%end%>
                     </div>
                     <!-- END profile-header-img -->
                     <!-- BEGIN profile-header-info -->
                     <div class="profile-header-info">
                        <div class="profile-header-name">
                        <h4 class=" m-t-10 m-b-5"><%=@user.display_name%> <a href="https://open.spotify.com/user/<%=@user.id%>"><i class="bi bi-spotify"></i></a></h4>
                        <%if(@currently_playing)%>
                           <h4 class=" m-t-10 m-b-5">In ascolto: <%=link_to @currently_playing.name,"https://open.spotify.com/track/"+@currently_playing.id %> di <%=link_to @currently_playing.artists.first.name, @currently_playing.artists.first.external_urls[:spotify]%> </h4>
                        <%end%>
                        </div>
                        <p class="m-b-10">La maremma è maiala</p>
                        <% if @u==current_user %>
                        <a href="#" class="btn btn-sm btn-info mb-2">Edit Profile</a>
                        <%end%>
                     </div>
                     <!-- END profile-header-info -->
                     <div class="pt-2">
                        <span><%= String(@posts.count()) %> post</span>
                        <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#followersModal">
                        <%= String(@u.followers.length()) %> Followers
                        </button>
                        <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#followingModal">
                        <%= String(@u.followings.length()) %> Following
                        </button>
                        <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#communityModal">
                        <%= String(@communities.count()) %> Community
                        </button>
                        <section id="all-links"class="mt-2">
                            <% if @u.uid == current_user.uid %>
                                <%= button_to "Logout", destroy_user_session_path, data: {turbo: "false"}, method: :delete, :class => "btn btn-outline-warning" %>
                            <% elsif current_user.followings.include?(@u) %>
                                <h5><%= button_to "Unfollow",unfollow_user_path, method: "POST",:class => "btn btn-outline-danger" %></h5>
                            <% else %>
                                <h5><%= button_to "Follow", follow_user_path, method: "POST", :class => "btn btn-outline-success" %></h5>
                            <% end%>
                            
                            <br>
                        </section>
                        <% unless @u==current_user %>
                           <%= button_to "Chat", create_chat_path(@u.id),:class => "btn btn-outline-info" %>
                        <%end%>
                        <nav>
                           <div class="nav nav-tabs" id="nav-tab" role="tablist">
                              <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Posts</button>
                              <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Tastes</button>
                           </div>
                        </nav>
                     </div>
                        <!-- Modal -->
                        <div class="modal fade" id="followingModal" tabindex="-1" aria-labelledby="followingModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="followingModalLabel">Following</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                 <% @u.followings.each  do |following| %>
                                    <a href="/user/<%= String(following.uid) %>" ><%= following.name %></a><br>
                                 <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="modal fade" id="followersModal" tabindex="-1" aria-labelledby="followersModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="followersModalLabel">Followers</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                 <% @u.followers.each  do |followers| %>
                                    <a href="/user/<%= String(followers.uid) %>" ><%= followers.name %></a><br>
                                 <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="modal fade" id="communityModal" tabindex="-1" aria-labelledby="communityModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="communityModalLabel">Community</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                 <% @communities.each do |co| %>
                                    <a href="/communities/<%= String(co.id) %>" ><%= co.name %></a><br>
                                 <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                     </div>
                  </div>
                  <!-- END profile-header-content -->
                  <!-- BEGIN profile-header-tab 
                  <ul class="profile-header-tab nav nav-tabs">
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-with-timeline-posts" target="__blank" class="nav-link_">POSTS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-about" target="__blank" class="nav-link_">ABOUT</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-photos" target="__blank" class="nav-link_">PHOTOS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/profile-videos" target="__blank" class="nav-link_">VIDEOS</a></li>
                     <li class="nav-item"><a href="https://www.bootdey.com/snippets/view/bs4-profile-friend-list" target="__blank" class="nav-link_ active show">FRIENDS</a></li>
                  </ul>-->
                  <!-- END profile-header-tab -->
               </div>
            </div>
            <!-- end profile -->
            <!-- begin profile-content -->
            
            <div class="tab-content container text-center" id="nav-tabContent">
               <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                  <div class="profile-content text-start">
                  <!-- begin tab-content -->
                     <div class="tab-content p-0">
                        <!-- begin #profile-post tab -->
                        <div class="tab-pane fade active show" id="profile-post">
                           <!-- begin timeline -->
                           <ul class="timeline">
                              <% @posts.each do |post| %>
                                 <% if post.user==@u %>
                                    <%= render "posts/post", post: post, communities: @communities%>
                                 <% end %>
                              <% end %>
                           </ul>
                        </div>
                        <!-- end #profile-post tab -->
                     </div>
                     <!-- end tab-content -->
                  </div>
               </div>
               <div class="tab-pane fade " id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                  <div class="container text-center">
                     <div class="row align-items-start">
                        <div class="col-6">
                              <div class="card">
                                 <h5 class="card-header">Top 5 tracks</h5>
                                 <div class="card-body">
                                    <%if @top_tracks.size==0%>
                                       <p>L'utente non ha tracce preferite</p>
                                    <%else%>
                                       <ul class="list-group-flush top_5_tracks">
                                          <% @top_tracks.each do |track| %>
                                             <%= render "partials/track", track: track%>   
                                          <% end %>
                                       </ul>
                                    <%end%>
                                 </div>
                              </div>
                        </div>
                        <div class="col-6">
                              <div class="card">
                                 <h5 class="card-header">Favorite artist</h5>
                                 <div class="card-body">
                                    <%if @top_artist%>
                                       <iframe style="border-radius:12px" src="https://open.spotify.com/embed/artist/<%=@top_artist.id%>?utm_source=generator" width="100%" height="523" frameBorder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
                                    <%else%>
                                       <p>L'utente non ha un artista preferito</p>
                                    <%end%>
                                 </div>
                              </div> 
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <!-- end profile-content -->
         </div>
      </div>
   </div>
</div>
        
    </body>
</html>